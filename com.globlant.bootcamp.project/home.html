<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Estrenos</title>
    <link rel="stylesheet" href="css/trailers.css">
    <link rel="stylesheet" href="css/menu.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/home.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

</head>
<body>


<header>
    <section id="menu">
        <nav id="menu_gral">
            <ul class="menu">
                <li><a href="home.html"><i class="icon-home"></i>HOME</a>
                    <ul class="sub-menu">
                    </ul>
                </li>
                <li><a  href="#"><i class="icon-user"></i>MOVIES</a>
                    <ul class="sub-menu">
                        <li><a href="newMovie.html">New</a></li>
                        <li><a href="movieDataSheet.html">Movie</a></li>
                        <li><a href="home.html">Search</a></li>
                    </ul>
                </li>
                <li><a  href="#"><i class="icon-camera"></i>HELP</a>
                    <ul class="sub-menu">
                        <li><a href="#">Sub-Menu 1</a></li>
                        <li><a href="#">Level 3 Menu</a>
                            <ul>
                                <li><a href="#">Sub-Menu 4</a></li>
                                <li><a href="#">Sub-Menu 5</a></li>
                                <li><a href="#">Sub-Menu 6</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li><a  href="#"><i class="icon-bullhorn"></i>ABOUT US</a></li>
                <li><a  href="#"><i class="icon-envelope-alt"></i>CONTACT</a></li>
            </ul>
        </nav>

    </section>

</header>

<section id="filtersSection">
    <article id="filters1">

            <ul class="menu" >
                <li><a href="#" id="allButton" ><i class="icon-home"></i>ALL</a></li>
                <li><a  href="#" id="popularButton"><i class="icon-user"></i>POPULAR</a></li>
                <li><a  href="#"id="recentButton"><i class="icon-bullhorn"></i>RECENT</a></li>
            </ul>

            <select id="selectGenres" name="generos" style="margin-left: 16%;">

            </select>
    </article>

    <article id="filters2">

        <ul class="menu">
            <li> <input id="inputSearch" type="text" name=""></li>


            <input type="submit" id="searchButton" value="Search" style="width: 10em">

        </ul>


    </article>
</section>

<section id="filtersMovies">

    <table id="tableMovies" border="0"  cellspacing="20"></table>

</section>


<footer class="footer-distributed">
    <div class="footer-left">

        <p class="footer-links">
            <a href="#">Home</a>
            ·
            <a href="#">Movies</a>
            ·
            <a href="#">Help</a>
            ·
            <a href="#">About Us</a>
            ·
            <a href="#">Contact</a>
        </p>

        <p class="footer-company-name">GLBMovies &copy; 2016</p>

        <div class="footer-icons">

            <a href="#"><i class="fa fa-facebook"></i></a>
            <a href="#"><i class="fa fa-twitter"></i></a>
            <a href="#"><i class="fa fa-linkedin"></i></a>
            <a href="#"><i class="fa fa-github"></i></a>

        </div>

    </div>

    <div class="footer-right">

        <p>Contact Us</p>

        <form action="#" method="post">

            <input type="text" name="email" placeholder="Email" />
            <textarea name="message" placeholder="Message"></textarea>
            <button>Send</button>

        </form>

    </div>

</footer>

    <script type="text/javascript">

        //var text = '{"id":1,"title":"Funny People","year":"2009","released":"2009-04-29T00:00:00.0Z","genre":"Comedy, Drama","director":"Judd Apatow","actors":"Adam Sandler, Seth Rogen","plot":"When seasoned comedian George Simmons learns of his terminal, inoperable health condition, his desire to form a genuine friendship causes him to take a relatively green performer under his wing as his opening act.","poster":"http://ia.media-imdb.com/images/M/MV5BMTMxNDQ5MTA5MF5BMl5BanBnXkFtZTcwMzUyMDUwMg@@._V1_SX300.jpg","rating":2}';
        //var text = '[{"id":1,"title":"Funny People","year":"2009","released":"2009-04-29T00:00:00.0Z","genre":"Comedy, Drama","director":"Judd Apatow","actors":"Adam Sandler, Seth Rogen","plot":"When seasoned comedian George Simmons learns of his terminal, inoperable health condition, his desire to form a genuine friendship causes him to take a relatively green performer under his wing as his opening act.","poster":"http://ia.media-imdb.com/images/M/MV5BMTMxNDQ5MTA5MF5BMl5BanBnXkFtZTcwMzUyMDUwMg@@._V1_SX300.jpg","rating":2.1},{"id":2,"title":"The Hangover Part II","year":"2011","released":"2011-05-26T00:00:00.0Z","genre":"Comedy","director":"Todd Phillips","actors":"Bradley Cooper, Zach Galifianakis","plot":"Right after the bachelor party in Las Vegas, Phil, Stu, Alan, and Doug jet to Thailand for Stus wedding. Stus plan for a subdued pre-wedding brunch, however, goes seriously awry.","poster":"http://ia.media-imdb.com/images/M/MV5BMTM2MTM4MzY2OV5BMl5BanBnXkFtZTcwNjQ3NzI4NA@@._V1_SX320.jpg","rating":3},{"id":3,"title":"Fight Club","year":"1999","released":"1999-10-15T00:00:00.0Z","genre":"Drama","director":"David Fincher","actors":"Edward Norton, Brad Pitt","plot":"An insomniac office worker, looking for a way to change his life, crosses paths with a devil-may-care soap maker, forming an underground fight club that evolves into something much, much more...","poster":"http://ia.media-imdb.com/images/M/MV5BMjIwNTYzMzE1M15BMl5BanBnXkFtZTcwOTE5Mzg3OA@@._V1_SX300.jpg","rating":4.2}]';
        //var text = '[{"id":1,"title":"Funny People","year":"2009","released":"2009-04-29T00:00:00.0Z","genre":"Comedy, Drama","director":"Judd Apatow","actors":"Adam Sandler, Seth Rogen","plot":"When seasoned comedian George Simmons learns of his terminal, inoperable health condition, his desire to form a genuine friendship causes him to take a relatively green performer under his wing as his opening act.","poster":"http://ia.media-imdb.com/images/M/MV5BMTMxNDQ5MTA5MF5BMl5BanBnXkFtZTcwMzUyMDUwMg@@._V1_SX300.jpg","rating":2}]';
        var text = '[{"id":1,"title":"Funny People","year":"2009","released":"2009-04-29T00:00:00.0Z","genre":"Comedy, Drama","director":"Judd Apatow","actors":"Adam Sandler, Seth Rogen","plot":"When seasoned comedian George Simmons learns of his terminal, inoperable health condition, his desire to form a genuine friendship causes him to take a relatively green performer under his wing as his opening act.","poster":"http://ia.media-imdb.com/images/M/MV5BMTMxNDQ5MTA5MF5BMl5BanBnXkFtZTcwMzUyMDUwMg@@._V1_SX300.jpg","rating":2},{"id":2,"title":"The Hangover Part II","year":"2011","released":"2011-05-26T00:00:00.0Z","genre":"Comedy","director":"Todd Phillips","actors":"Bradley Cooper, Zach Galifianakis","plot":"Right after the bachelor party in Las Vegas, Phil, Stu, Alan, and Doug jet to Thailand for Stus wedding. Stus plan for a subdued pre-wedding brunch, however, goes seriously awry.","poster":"http://ia.media-imdb.com/images/M/MV5BMTM2MTM4MzY2OV5BMl5BanBnXkFtZTcwNjQ3NzI4NA@@._V1_SX320.jpg","rating":3.5},{"id":3,"title":"Fight Club","year":"1999","released":"1999-10-15T00:00:00.0Z","genre":"Drama","director":"David Fincher","actors":"Edward Norton, Brad Pitt","plot":"An insomniac office worker, looking for a way to change his life, crosses paths with a devil-may-care soap maker, forming an underground fight club that evolves into something much, much more...","poster":"http://ia.media-imdb.com/images/M/MV5BMjIwNTYzMzE1M15BMl5BanBnXkFtZTcwOTE5Mzg3OA@@._V1_SX300.jpg","rating":4.5},{"id":4,"title":"Toy Story","year":"1995","released":"1995-01-22T00:00:00.0Z","genre":"Animation, Adventure, Comedy","director":"John Lasseter","actors":"Tom Hanks, Tim Allen","plot":"A cowboy doll is profoundly threatened and jealous when a new spaceman figure supplants him as top toy in a boys room.","poster":"http://ia.media-imdb.com/images/M/MV5BMTgwMjI4MzU5N15BMl5BanBnXkFtZTcwMTMyNTk3OA@@._V1_SX300.jpg","rating":4.2},{"id":5,"title":"Forrest Gump","year":"1994","released":"1994-07-06T00:00:00.0Z","genre":"Drama, Romance","director":"Robert Zemeckis","actors":"Tom Hanks, Rebecca Williams","plot":"Forrest Gump, while not intelligent, has accidentally been present at many historic moments, but his true love, Jenny Curran, eludes him.","poster":"http://ia.media-imdb.com/images/M/MV5BMTI1Nzk1MzQwMV5BMl5BanBnXkFtZTYwODkxOTA5._V1_SX300.jpg","rating":4.3},{"id":6,"title":"Shrek","year":"2001","released":"2001-05-18T00:00:00.0Z","genre":"Animation, Adventure, Comedy","director":"Andrew Adamson","actors":"Mike Myers, Eddie Murphy","plot":"After his swamp is filled with magical creatures, an ogre agrees to rescue a princess for a villainous lord in order to get his land back.","poster":"http://ia.media-imdb.com/images/M/MV5BMTk2NTE1NTE0M15BMl5BanBnXkFtZTgwNjY4NTYxMTE@._V1_SX300.jpg","rating":4.5},{"id":7,"title":"Inglourious Basterds","year":"2009","released":"2009-08-21T00:00:00.0Z","genre":"Adventure, Drama, War","director":"Quentin Tarantino","actors":"Brad Pitt, Christoph Waltz","plot":"In Nazi-occupied France during World War II, a plan to assassinate Nazi leaders by a group of Jewish U.S. soldiers coincides with a theatre owners vengeful plans for the same.","poster":"http://ia.media-imdb.com/images/M/MV5BMjIzMDI4MTUzOV5BMl5BanBnXkFtZTcwNDY3NjA3Mg@@._V1_SX300.jpg","rating":3.9},{"id":8,"title":"Apoclaypse Now","year":"1979","released":"1979-08-15T00:00:00.0Z","genre":"Drama, War","director":"Francis Ford Coppola","actors":"Marlon Brando, Martin Sheen","plot":"During the Vietnam War, Captain Willard is sent on a dangerous mission into Cambodia to assassinate a renegade colonel who has set himself up as a god among a local tribe.","poster":"http://ia.media-imdb.com/images/M/MV5BMTcyMzQ5NDM4OV5BMl5BanBnXkFtZTcwODUwNDg3OA@@._V1_SX300.jpg","rating":3.7},{"id":9,"title":"The Pianist","year":"2003","released":"2003-03-28T00:00:00.0Z","genre":"Biography, Drama, War","director":"Roman Polanski","actors":"Adrien Brody, Emilia Fox","plot":"A Polish Jewish musician struggles to survive the destruction of the Warsaw ghetto of World War II.","poster":"http://ia.media-imdb.com/images/M/MV5BMTc4OTkyOTA3OF5BMl5BanBnXkFtZTYwMDIxNjk5._V1_SX300.jpg","rating":3.5},{"id":10,"title":"A clockwork Orange","year":"1971","released":"1972-02-02T00:00:00.0Z","genre":"Crime, Drama, Sci-Fi","director":"Stanley Kubrick","actors":"Malcolm McDowell, Patrick Magee","plot":"In future Britain, charismatic delinquent Alex DeLarge is jailed and volunteers for an experimental aversion therapy developed by the government in an effort to solve societys crime problem","poster":"http://ia.media-imdb.com/images/M/MV5BMTY3MjM1Mzc4N15BMl5BanBnXkFtZTgwODM0NzAxMDE@._V1_SX300.jpg","rating":4.7}]';
        //var movies = jQuery.parseJSON("./file/moviese.json");
        //var jsonFiles = $.getJSON("files/moviese.json");
        var movies = jQuery.parseJSON(text);

        //Hace una copia del objeto movies original (por si lo necesitamos más adelante).
        var allMoviesByDefault = JSON.parse(JSON.stringify(movies));


        //Se inicilaliza el componente html select
        var genres = getGenres(movies);
        loadGenresIntoHTML(genres);
        printMovies(movies);

        //printMoviesTEST(movies);


        //----- Utilizando para probar las funciones
        //movies = sortByReleased(movies);
        //movies = sortByRating(movies);
        //getMovies(movies);


        //searchMovie("Forrest",allMoviesByDefault);

        //-----


        //Imprime todas las peliculas.
        $( "#allButton" ).click(function(){
            printMovies(allMoviesByDefault);

        });

        //Imprime las peliculas ordenadas por rating.
        $( "#popularButton" ).click(function(){
            var popularMovies = sortByRating(movies);
            printMovies(popularMovies);

        });

        //Imprime las peliculas ordenadas por año.
        $( "#recentButton" ).click(function(){
            var recentMovies = sortByReleased(movies);
            printMovies(recentMovies);

        });


        //Búsqueda dado un texto
        $( "#searchButton" ).click(function(){
            var text = document.getElementById("inputSearch").value;
            searchMovie(text,allMoviesByDefault);

        });

        $("#selectGenres").change(function () {
            var sel = document.getElementById('selectGenres').value;
            searchMovieByGenre(sel.toString(), movies);
        });




        //Injecta el html correspondiente a partir de la collecion de movies de entrada.
        function printMovies1(mov) {

            var moviesCant = mov.length;
            var imagenes = "<tr>";
            var max = 0;
            for (i = 0; i < moviesCant; i++) {
                imagenes += '<td><img src="' + mov[i].poster + '"width="100%"></td>';
                max = max + 1;

                if (max == 6) {
                    imagenes += '</tr>';
                    imagenes += loadTitle(mov, i - 5, i);
                    max = 0;
                } else {
                    if (moviesCant - 1 == i) {
                        imagenes += '</tr>';
                        imagenes += loadTitle(mov, i - 3, i);
                    }

                }


            }
            imagenes += "</tr>";
            document.getElementById("tableMovies").innerHTML = imagenes;
        }

        //Injecta el html correspondiente con los datos de la película (con Title, Year, Rating).
        function loadTitle(mov, ini, end)
        {
            //var cant = mov.length - pos+1;
            var result = "<tr>";

            for (x = ini; x <= end; x++) {
                result += '<td><p style="width: 100%; display: inline-block;">'+ mov[x].title + '</br>'+ mov[x].year + '</br>Rating: '+ mov[x].rating + '</br>'+ mov[x].genre +'</p></td>';
            }
            result += '</tr>';

            return result;
        }

        //TEST--------------OK (FUNCIONA)
        function printMovies(mov) {

            var moviesCant = mov.length;
            var imagenes = "<tr>";
            var max = 0;
            for (i = 0; i < moviesCant; i++) {

                var texto = '</br><p style="width: 100%; display: inline-block;">' + mov[i].title + '</br>'+ mov[i].year + '</br>Rating: '+ mov[i].rating + '</br>'+ mov[i].genre +'</p>';

                imagenes += '<td><img src="' + mov[i].poster + '"width="100%">'+ texto+'</td>';
                max = max + 1;

                if (max == 6) {
                    imagenes += '</tr><tr>';
                    max = 0;
                }


            }
            imagenes += "</tr>";
            document.getElementById("tableMovies").innerHTML = imagenes;
        }




        //Injecta en el componente SELECT de HTML, los distintos generos existentes de las películas
        function loadGenresIntoHTML(genres) {
            var sel = document.getElementById('selectGenres');
            for(var i = 0; i < genres.length; i++) {
                var opt = document.createElement('option');
                opt.innerHTML = genres[i];
                opt.value = genres[i];
                sel.appendChild(opt);
            }
        }



        //Ordena las películas for fecha de lanzamiento.
        function sortByReleased(mov) {
            mov.sort(function(a, b) {
                if (a.released < b.released) { return 1; }
                if (a.released > b.released) { return -1; }
                return 0;
            });

            return mov;
        }

        //Ordena las películas por Rating.
        function sortByRating(mov) {
            mov.sort(function(a, b) {
                if (a.rating < b.rating) { return 1; }
                if (a.rating > b.rating) { return -1; }
                return 0;
            });

            return mov;
        }





        //Retorna un array con los distintos generos que hay, elimina los duplicados.
        function getGenres(mov) {
            var moviesCant = mov.length;
            var genres = [];

            //Se obtienen todos los generos (cada pilicula puede tener varios generos separados por ",")
            for (i = 0; i < moviesCant; i++) {
                var result = mov[i].genre.split(',');

                //Se eliminan los espacios en blanco
                var cant = result.length;
                for (x = 0; x < cant; x++) {
                    genres.push(result[x].trim());
                }
            }

            //Se eliminan los repetidos.
            var uniqueGenres = genres.reduce(function(a,b){
                if (a.indexOf(b) < 0 ) a.push(b);
                return a;
            },[]);

            //---Prueba
            //for (a = 0; a < uniqueGenres.length; a++) {
            //    console.log(uniqueGenres[a]);
            //}
            //----


            return uniqueGenres;
        }


        function searchMovie(str, mov){
            var result = [];
            var moviesCant = mov.length;

            console.log(mov);

            for (i = 0; i < moviesCant; i++) {

                //verifica si contiene el substring. //POR AHORA ES CASE SENSITIVE.
                if(JSON.stringify(mov[i]).indexOf(str) > 0){
                    //result.append(mov[i]);
                    console.log(mov[i]);
                    result.push(JSON.parse(JSON.stringify(mov[i])));
                    //result.push(JSON.stringify(mov[i]));
                }
            }
            console.log(result);
            printMovies(result);

            //return result;
        }


        function searchMovieByGenre1(gen, mov){
            var result = [];
            var moviesCant = mov.length;

            for (i = 0; i < moviesCant; i++) {

                //verifica si contiene el substring. //POR AHORA ES CASE SENSITIVE.
                if(JSON.stringify(mov[i].genre).indexOf(gen) > -1){
                    result.push(JSON.parse(JSON.stringify(mov[i])));
                    //result.push(JSON.stringify(mov[i]));
                }
            }
            printMovies(result);
            //printMoviesTEST(result);

        }

        //TEST OK FUNCIONA
        function searchMovieByGenre(gen, mov){
            var result = [];
            var moviesCant = mov.length;
            for (i = 0; i < moviesCant; i++) {


                //console.log(mov[i].genre.toString());
                var a = mov[i].genre.toString();

                //verifica si contiene el substring. //POR AHORA ES CASE SENSITIVE.
                if(a.indexOf(gen.toString()) > -1){
                    result.push(JSON.parse(JSON.stringify(mov[i])));
                    //result.push(JSON.stringify(mov[i]));
                    //console.log(mov[i]);

                    console.log(gen);
                }
            }
            printMovies(result);
            //printMoviesTEST(result);
            console.log(result);
            console.log(result.length);
        }
    
    </script>





</body>

</html>